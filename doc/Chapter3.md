# 面向混凝土表面缺陷的缺陷增强多尺度视觉编码与领域语义对齐方法

## 问题引入

多模态大语言模型在通用图文理解和视觉问答任务上已经展现出了强大的能力，但是主流的MLLM的视觉编码分支通常是基于面向自然场景的通用编码器设计，难以直接适应混凝土表面缺陷理解这一特定场景。与通用视觉编码器训练时使用的自然图像相比，混凝土缺陷（如裂缝、渗水）常在视觉上呈现出细小、细长、低对比度、形态多变且与背景纹理高度混叠等特征，这使得视觉编码器在为大语言模型提供视觉特征阶段就面临了挑战。

现有MLLM通常直接采用在自然图像上预训练的通用视觉编码器，然后通过简单的投影或中间模块将视觉特征接入大语言模型。这一设计虽然在通用图文理解任务上表现较好，但是其视觉-语义空间转换并未针对混凝土表面缺陷视觉特征与工程领域专有词汇进行优化，导致缺陷信息在视觉编码阶段出现混杂与偏移，后续的语言推理和决策无法在可靠的视觉基础上进行。

### **混凝土表面缺陷视觉特征分析**

工程实践中，混凝土构件表面的缺陷形式多样，其中裂缝、剥落、渗水以及构筑物析出是最常见、且与结构安全性和耐久性密切相关的几类。这些类型的缺陷在视觉上的特征共性为，都表现为相对正常混凝土表面的异常纹理或颜色分布，往往以低对比度、小尺度变化的形式叠加在大面积背景之上。但不同的缺陷也呈现出不同的几何形态特征和空间分布模式。

**裂缝类**

裂缝是工程实践中最为关注的结构缺陷。裂缝通常以线状或带状形式出现，宽度较小，长度可从几厘米到数米不等。同时裂缝往往沿某一方向延伸，可能伴随弯折、分支或交叉等复杂形态，分析裂缝的整体走向、分支结构与构件类型、约束条件密切相关，这些特征对理解裂缝缺陷场景十分重要。

**剥落类**

剥落、破损体现为结构保护层或混凝土局部脱落、碎裂，露出内部粗骨料或钢筋。与线状裂缝相比，剥落往往以面积较大的不规则斑块出现，其尺度可达到数十或数百像素，具有明显的区域属性。剥落缺陷区域与周围完好的混凝土在纹理、粗糙度上有明显差异，可能出现粗骨料外露、碎块堆积等特征，纹理表现更粗糙，结构更杂乱。同时，由于材质差异、光照反射等因素，剥落缺陷区域往往与周围背景有较大差别，例如更暗或更亮、局部阴影更重。

**渗水类**

渗水、漏水引发的湿渍往往与结构耐久性问题有关。渗水痕迹往往呈现色斑状或条带状分布，但与剥落类缺陷相比边界较模糊，而且通常通过连续的亮度或颜色渐变过渡到正常区域。湿渍区域通常比周围表面更暗或呈现特定色调，属于低频亮度和颜色异常。

**构筑物析出**

构筑物析出（例如碳酸盐结晶、盐析等）通常表现为白色或浅色晶体在构件表面堆积。构筑物析出相对于周围混凝土在表面纹理上既有细小颗粒，也可能呈现片状堆积。在工程实际中，析出区域通常与渗水路径或裂缝相伴出现，其空间位置和形态可能在一定程度上反映构件内部水迁移路径。

可以看出，在不同尺度下混凝土缺陷呈现出的视觉特征为：较细尺度下，高频出现的线状边缘，具有强方向性和连通性；中等尺度下，区域形状和纹理异常；较大尺度下，颜色或亮度的渐变与模糊边界。这意味着，面向混凝土表面缺陷的视觉编码器需要具备：对高频细节的感知能力，以捕捉裂缝以及析出物的细小纹理以及边缘；对中尺度区域纹理和形状的建模能力，以识别剥落区域的轮廓以及内部纹理差异；对大尺度亮度和颜色的区别能力，以定位渗水等低对比度、大范围缺陷；以及将局部缺陷细节与构件整体语义联系起来的关联能力。

### 通用视觉编码器难以保留混凝土表面缺陷多尺度结构信息

通用视觉编码器在结构设计上更关注物体级语义，而非混凝土缺陷在不同空间尺度上的细粒度变化。一方面，ViT、Swin 等基于 Transformer 的模型在输入端采用固定尺寸 patch 划分（如 16×16 或 4×4），随后通过层级下采样和窗口注意力逐步降低分辨率、扩大感受野，这使得网络在高层主要聚焦于 patch 级语义和目标轮廓，而不再关心单个像素或极细结构的变化。对于仅有数个像素宽度的裂缝和局部析出细纹，这种多次下采样和特征聚合会在早期就大幅削弱其响应；对于中尺度的剥落区域，其范围与纹理信息在不断的空间压缩和跨层融合中被模糊为“某个区域略粗糙的材质”。通用编码器的多尺度结构更多是为适应目标大小变化而设计的，针对上述的混凝土表面缺陷的视觉特征，很难满足多尺度的特征提取需求。

另一方面，在纹理与颜色建模方面，通用视觉编码器存在与混凝土缺陷特征的矛盾。以 CLIP-Visual 为代表的对齐模型在大规模自然图像上通过图–文对齐损失进行预训练，其优化目标只要求整幅图像的语义与文本匹配即可，因此网络会主动学习对局部污渍、阴影、亮度不均以及细碎纹理变化的鲁棒性，将其视为对类别判别无关的噪声。对于混凝土表面而言，渗水往往表现为大尺度、低对比度的颜色渐变，容易被当作光照变化忽略；构筑物析出则表现为局部高亮细纹理叠加在粗糙背景之上，容易与普通污染斑点混淆。同时，这类backbone通常在高层通过全局平均池化将空间信息压缩为少量全局向量，裂缝的走向和连通路径、剥落区域的具体形状等空间信息将被进一步抹平。

fig：ViT Swin CLIP对缺陷的特征提取例图

### 现有视觉语言适配器缺乏视觉token级别的语义对齐能力

现有MLLM中的视觉语言适配器的作用是将视觉token映射成输入LLM语言空间的文本token，而在训练过程中，跨模态对齐主要依赖粗粒度的图像级或区域级的监督，这种监督只对图像级别的整体匹配施加约束，而无法为每一个视觉token提供足够粒度的信号，因此很难捕捉细粒度语义并实现稳定的视觉-语言融合。同时，现有MLLM架构中，视觉token与文本token拼接后进入LLM，适配器参数主要通过自回归语言建模损失被更新。这种目标对视觉token的约束时间接的、端到端的结果导向，会导致适配器只学习到“对LLM生成回答有用但在embedding空间语义不对齐”的编码方案，导致输出语义信息的错位。

fig![image-20251204203213212](C:\Users\Valentiens Faye\AppData\Roaming\Typora\typora-user-images\image-20251204203213212.png)类似这张图

为了应对上述挑战，需要提出高效的缺陷特征提取与跨模态对齐方法，在MLLM模型参数量较小的情况下，精准提取不同尺度的混凝土缺陷特征，并保证视觉语言适配器的嵌入过程避免语义错位。

（1）针对混凝土以及路面缺陷的多尺度特征提取，已有不少工作尝试在视觉编码器层面缓解小缺陷和复杂背景的问题。例如，Liu 等提出的 Crack-MsCGA 网络，通过卷积+多尺度注意力结构增强不同尺度裂缝的响应，用以应对多尺度裂缝检测难题；Yang 等利用 Transformer 编解码结构构建多尺度特征融合网络，在编码端提取不同分辨率特征，在解码端融合以分割细小路面裂缝；Chen 等提出的 Multi-Scale Attention Network 则在不同尺度引入注意力模块，强化路面裂缝和坑槽等缺陷的检测能力；Tan 等的 ETAFHrNet 通过多尺度注意力与多分辨率特征融合，提高了细小、非对称裂缝的分割精度。在工业表面缺陷领域，Li 等提出 MSMA-SDD，多尺度多注意力 CNN 结构可提高不同尺寸、不同形状表面缺陷的检测精度；Liang 等提出的OCR-GAN则通过对高低频分量进行解耦和通道选择，从频率域强化细粒度纹理异常的表达。这些工作证明，合理利用多尺度网络结构、注意力机制以及频域建模，确实可以在特定任务上增强裂缝等缺陷的特征提取能力。然而，这些特征提取模型多面向裂缝这个单一缺陷，并未适配混凝土表面其他缺陷的视觉特征；同时，提取过程中的多尺度特征最终仍被压缩为任务特定输出，并未作为通用编码器的中间表征对其他部分开放。综合上述领域的研究，本章做出了以下改进：在视觉特征编码器层面，以多尺度Transformer为骨干，引入针对裂缝、剥落、渗水、析出等特征的缺陷增强模块DEM，在不同尺度显示分工：在高分辨率分支突出裂缝和析出物等细粒度高频纹理，在中尺度分支突出剥落区域的形状、边界与粗糙度，在大尺度分支突出渗水和析出颜色渐变与范围分布，从而构建一个面向多类混凝土缺陷的统一多尺度视觉特征编码器。

（2）在跨模态对齐与视觉语言适配器方向，近年的研究工作普遍沿用简单适配器配合图像级监督的范式：主流MLLM大多采用一层或少量MLP/线性层将视觉编码输出映射到LLM的输入空间，在预训练阶段通过图像级或区域级的自回归语言建模损失进行对齐。例如，LLaVA直接在冻结的CLIP ViT-L/14与Vicuna之间插入一层线性投影矩阵，将视觉特征整体映射到语言嵌入空间；MiniGPT-4同样只用单层线性投影将BLIP-2风格的视觉编码器输出对齐到Vicuna，依赖图像级对话监督训练。这种设计虽然有较小的参数规模并便于实现，但容易导致视觉token在LLM嵌入空间中对齐粗糙甚至混叠。同时，近年的工业异常检测领域尝试从CLIP端改进跨模态对齐效果。例如，AFE-CLIP在图文嵌入空间中对CLIP的全局特征进行状态建模与整流，使异常特征在嵌入空间中更加凸显；DDE-CLIP利用局部微小缺陷的细节表征来动态优化文本提示，缓解CLIP的域偏移和图文语义错配问题。这些工作的目标主要是得到缺陷分割，并没有解决如何将每个视觉token在LLM词向量空间中对齐到专业词汇这一问题。综合上述领域的研究，本章做出以下改进：在视觉语言适配器部分引入预训练的CLIP作为教师，通过token级的对比学习，将视觉编码输出的缺陷相关token显示拉近到混凝土缺陷领域专业词汇的文本嵌入领域，使得后续的多轮推理与RAG知识注入都建立在“已与土木工程专有词汇空间对齐”的视觉表示之上。

综上所述，为解决混凝土表面缺陷在多尺度结构与纹理异常上的特征提取问题，并在此基础上为后续MLLM的缺陷理解与推理提供高质量的视觉先验，本章节提出了一种面向混凝土缺陷的缺陷增强多尺度视觉编码与领域语义对齐方法（Defect-Enhanced Multi-Scale Vision Encoding and Domain-Aligned Adapter，DEM-DA）DEM-DA由缺陷增强多尺度视觉编码器DEM-Encoder与基于CLIP监督的领域语义适配器DA-Adapter两部分构成。在缺陷特征提取阶段，DEM-Encoder以多尺度Transformer为骨干，在不同分辨率特征图后引入缺陷增强模块DEM，从而获得同时区分缺陷类型与空间尺度的多尺度视觉特征表示；在跨模态语义对齐阶段，引入预训练CLIP文本编码器将混凝土缺陷相关视觉token拉近到混凝土专业词汇所在的文本子空间，使进入MLLM的视觉token同时携带多尺度缺陷信息与清晰的工程语义锚点，从而保证后续多模态推理与缺陷诊断在视觉表征层面贴近真实混凝土缺陷的数据分布。

## 总体框架

本章提出的面向混凝土表面缺陷的缺陷增强多尺度视觉编码与领域语义对齐方法（Defect-Enhanced Multi-Scale Vision Encoding and Domain-Aligned Adapter，DEM-DA）整体结构如图3-4所示。DEM-DA由两部分构成：一是面向混凝土多类缺陷的缺陷增强多尺度视觉编码器（Defect-Enhanced Multi-Scale Vision Encoder，DEM-Encoder），负责在不同空间尺度上提取并显式强化裂缝、剥落、渗水与构筑物析出等缺陷特征；二是基于CLIP监督的领域语义适配器（Domain-Aligned Adapter，DA-Adapter），负责将缺陷增强后的视觉token映射到与土木工程领域专有词汇对齐的语言嵌入空间，并作为视觉前缀送入多模态大语言模型。

在结构上，DEM-Encoder以多尺度Transformer骨干网络为基础，通过分层下采样获得不同分辨率的特征图。在每个尺度的特征图之后串联设计几何增强、纹理增强、颜色嵌入和低高频分离模块，并根据不同缺陷对不同尺度进行配置。DA-Adapter位于DEM-Encoder与LLM之间，负责接收多尺度缺陷特征，将各尺度特征图展平为视觉token序列，在训练过程中引入冻结的CLIP文本编码器对混凝土缺陷领域词汇进行编码，作为领域语义锚点，通过在适配器对齐头中涉及token级对比学习与聚类约束，拉近视觉token到专业词汇文本嵌入。

在视觉特征提取阶段，DEM-Encoder以多尺度Transformer骨干网络为基础，通过分层下采样获取四个分辨率尺度的特征图。针对混凝土表面缺陷在不同尺度上的显著差异，在各尺度特征图之后分别串联设计缺陷增强模块（Defect Enhancement Module，DEM），实现按尺度分工的缺陷显示建模。最终通过跨尺度特征融合与统一投影，得到用于跨模态对齐的缺陷增强特征图。

在跨模态对齐阶段，DA-Adapter位于DEM-Encoder与下游LLM之间。DA-Adapter首先将来自不同尺度的缺陷增强特征图展平为视觉token序列，随后多层感知机将这些视觉token映射到与CLIP文本编码器输出相同的嵌入维度。在训练阶段，引入冻结的CLIP文本编码器作为领域语义教师，以预先构建的缺陷图像与专业词汇训练出的图文对应关系为监督，对多层感知机进行训练，学习将缺陷区域的视觉token映射到相对的专业词汇所在的文本嵌入空间的能力。

通过以上设计，DEM-DA可以实现针对混凝土表面缺陷的视觉特征提取，并使视觉token在进入LLM之前就获得了与专业领域词汇对齐的表达。

## 缺陷增强多尺度视觉编码器

为解决通用视觉编码器难以同时保留混凝土表面缺陷，如裂缝、剥落、渗水及构筑物析出等多类缺陷在不同分辨率尺度上的结构和纹理信息的问题，本章在多尺度Transformer骨干网络之后设计了缺陷增强多尺度视觉编码器DEM-Encoder。DEM-Encoder在不修改原有骨干网络内部结构的前提下，仅在多尺度输出特征图后附加缺陷增强模块，对不同尺度特征分别进行针对性建模，并通过特征金字塔结构融合为一张统一的缺陷感知特征图，用于后续领域语义适配器DA-Adapter的跨模态对齐。

### 多尺度骨干网络结构设计

本章采用DefT（Defect Transformer）是面向密集预测任务设计的层次化视觉Transformer骨干。与直接输出单尺度特征的ViT相比，DefT在结构上更接近于卷积神经网络的金字塔模式，能够在不同分辨率上同时提供细粒度纹理与大范围语义信息，更适合作为混凝土缺陷分析任务的基础编码器。





























